<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Standardizing Assessment Model Output • asar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Standardizing Assessment Model Output">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">asar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="far fa-file-code fa-lg"></span>

    Functions
  </a>
</li>
<li>
  <a href="../asar-cheatsheet.pdf">
    <span class="fa fa-solid fa-key"></span>

    Cheatsheet
  </a>
</li>
<li>
  <a href="https://connect.fisheries.noaa.gov/asar_tutorial/" class="external-link">
    <span class="fa fa-regular fa-map"></span>

    Tutorial
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-file-contract fa-lg"></span>

    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/manual.html">Manual</a>
    </li>
    <li>
      <a href="../articles/markdown_notation.html">Markdown Notation</a>
    </li>
    <li>
      <a href="../articles/regional_workflows.html">Regional Workflows</a>
    </li>
    <li>
      <a href="../articles/accessibility_guide.html">Accessibility</a>
    </li>
    <li>
      <a href="../articles/custom-figs-tabs.html">Custom Figures &amp; Tables</a>
    </li>
    <li>
      <a href="../articles/convert_output_details.html">Standardizing Assessment Model Output</a>
    </li>
    <li>
      <a href="../articles/faqs.html">Frequently Asked Questions (FAQs)</a>
    </li>
    <li>
      <a href="../articles/caps-alttext-alt-workflows.html">Captions/alt text in Alternative Workflows</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book fa-lg"></span>

    References

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../SAR_USWC_Petrale_sole_skeleton.pdf">Petrale Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nmfs-ost/asar/issues" class="external-link">
    <span class="fas fa-question-circle fa-lg"></span>

    Issues
  </a>
</li>
<li>
  <a href="https://github.com/nmfs-ost/asar/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Standardizing Assessment Model Output</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nmfs-ost/asar/blob/HEAD/vignettes/convert_output_details.Rmd" class="external-link"><code>vignettes/convert_output_details.Rmd</code></a></small>
      <div class="hidden name"><code>convert_output_details.Rmd</code></div>

    </div>

    
    
<style type="text/css">
pre {
  overflow-x: auto;
  overflow-y: auto;
}

pre[class] {
  max-height: 100px;
}
</style>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This article describes the process behind developing the
<code><a href="../reference/convert_output.html">asar::convert_output</a></code> function and its setup so users who
want to use <code>asar</code> or <code>stockplotr</code> are still able
until <a href="https://github.com/nmfs-ost/asar/blob/main/R/convert_output.R" class="external-link"><code>convert_output.R</code></a>
includes functionality for other models.</p>
<!--- 
::: {.callout-tip, title: "Goal"}
The converter is designed to manipulate data to a long format with many rows and NAs. Essentially, the "estimate" column should contain all of the values in a model output while the rest of the columns make distinctions on what the number indicates.
:::
--->
<p>Additionally, after following this article, users who use it to
manipulate their assessment model output are encouraged to submit a <a href="https://github.com/nmfs-ost/asar/pulls" class="external-link">pull request</a> or <a href="https://github.com/nmfs-ost/asar/issues" class="external-link">issue</a> to use as an
example to include in the function. This collaboration will not only
allow us to expand the converter to include many assessment models, but
also do it <em>much faster</em>.</p>
<p>The converter was designed so that it would manipulate the output
file from the assessment (Report.sso for SS3, .rdat from BAM…). This
means that we have only configured it to work with a singular output
file so the converted data frame is limited to the data given to it from
that file. We have plans to expand upon this format to include other
data files associated with running the model, but this will not happen
in the near future.</p>
<div class="float">
<img src="figures/convert_output_flow.png" alt="A visual showing the process of the convert_output function in asar."><div class="figcaption">A visual showing the process of the
convert_output function in asar.</div>
</div>
</div>
<div class="section level2">
<h2 id="set-up-and-format">Set up and format<a class="anchor" aria-label="anchor" href="#set-up-and-format"></a>
</h2>
<p>The converter manipulates data sets by recognizing patterns based on
the assessment model (SS3, BAM, etc.) and organizes it by expanding all
data as single columns. This makes the data frame more machine readable
allowing users to plot the data or place it into tables. The format also
helps us as developers create other standardized procedures and
automation due to its ease of use.</p>
<p>The data is manipulated to follow the format in <span class="citation">@tbl-cols</span>. The majority of the code in the
function is specific for how one would manipulate the output with the
following exceptions. The code in the converter creates an empty data
frame with the columns referenced in <span class="citation">@tbl-cols</span> (See <a href="https://github.com/nmfs-ost/asar/blob/c8db61f325e9926461c70ef2d62349eb8d2bf2dd/R/convert_output.R#L45-L81" class="external-link">code</a>).
At the end of the function, standard naming conventions are applied to
rename labels of parameters or quantities as followed in <span class="citation">@sec-namecon</span>. Currently, we have files to use as
examples to change the names of labels following our convention. One of
the example files can be downloaded <a href="https://github.com/nmfs-ost/asar/blob/main/inst/resources/ss3_var_names.xlsx" class="external-link">here</a>.
The final data frame is exported to the user’s environment as an object,
if it is assigned an object name (e.g.,
<code>my_converted_output &lt;- convert_output(...)</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"example_conout.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hake_conout</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              label estimate year fleet  sex area growth_pattern</span></span>
<span><span class="co">## 1 spawning_biomass  2017090 2016    NA &lt;NA&gt;   NA             NA</span></span>
<span><span class="co">## 2 spawning_biomass  2286740 2017    NA &lt;NA&gt;   NA             NA</span></span>
<span><span class="co">## 3 spawning_biomass  1972500 2018    NA &lt;NA&gt;   NA             NA</span></span>
<span><span class="co">## 4 spawning_biomass  1633220 2019    NA &lt;NA&gt;   NA             NA</span></span>
<span><span class="co">## 5 spawning_biomass  1509990 2020    NA &lt;NA&gt;   NA             NA</span></span>
<span><span class="co">## 6      recruitment  2251210 2016    NA &lt;NA&gt;   NA             NA</span></span>
<span><span class="co">##          module_name uncertainty_label uncertainty time season subseason age</span></span>
<span><span class="co">## 1 DERIVED_QUANTITIES              &lt;NA&gt;          NA   NA     NA        NA  NA</span></span>
<span><span class="co">## 2 DERIVED_QUANTITIES              &lt;NA&gt;          NA   NA     NA        NA  NA</span></span>
<span><span class="co">## 3 DERIVED_QUANTITIES              &lt;NA&gt;          NA   NA     NA        NA  NA</span></span>
<span><span class="co">## 4 DERIVED_QUANTITIES              &lt;NA&gt;          NA   NA     NA        NA  NA</span></span>
<span><span class="co">## 5 DERIVED_QUANTITIES              &lt;NA&gt;          NA   NA     NA        NA  NA</span></span>
<span><span class="co">## 6 DERIVED_QUANTITIES              &lt;NA&gt;          NA   NA     NA        NA  NA</span></span>
<span><span class="co">##   len_bins initial likelihood gradient estimated bio_pattern birthseas</span></span>
<span><span class="co">## 1       NA      NA         NA       NA        NA          NA        NA</span></span>
<span><span class="co">## 2       NA      NA         NA       NA        NA          NA        NA</span></span>
<span><span class="co">## 3       NA      NA         NA       NA        NA          NA        NA</span></span>
<span><span class="co">## 4       NA      NA         NA       NA        NA          NA        NA</span></span>
<span><span class="co">## 5       NA      NA         NA       NA        NA          NA        NA</span></span>
<span><span class="co">## 6       NA      NA         NA       NA        NA          NA        NA</span></span>
<span><span class="co">##   settlement morph type factor platoon month sexes part bin kind nsim age_a</span></span>
<span><span class="co">## 1         NA    NA &lt;NA&gt;     NA      NA    NA    NA   NA  NA   NA   NA    NA</span></span>
<span><span class="co">## 2         NA    NA &lt;NA&gt;     NA      NA    NA    NA   NA  NA   NA   NA    NA</span></span>
<span><span class="co">## 3         NA    NA &lt;NA&gt;     NA      NA    NA    NA   NA  NA   NA   NA    NA</span></span>
<span><span class="co">## 4         NA    NA &lt;NA&gt;     NA      NA    NA    NA   NA  NA   NA   NA    NA</span></span>
<span><span class="co">## 5         NA    NA &lt;NA&gt;     NA      NA    NA    NA   NA  NA   NA   NA    NA</span></span>
<span><span class="co">## 6         NA    NA &lt;NA&gt;     NA      NA    NA    NA   NA  NA   NA   NA    NA</span></span></code></pre>
<p>The data frame is structured in following the convention of FIMS but
removing the use of S4 or S3 data frame classes encouraging a more user
friendly set up to start. The following format outlines the standard
data frame:</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="76%">
</colgroup>
<thead><tr class="header">
<th>Column label</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>label</td>
<td>standard name for the estimate/parameter/quantity (cha)</td>
</tr>
<tr class="even">
<td>estimate</td>
<td>the actual value for the estimate/parameter/quantity</td>
</tr>
<tr class="odd">
<td>module_name</td>
<td>describes the category of data found in the original data - allows
us and familiar users to validate the converter is operating correctly
and the correct data is being pulled</td>
</tr>
<tr class="even">
<td>year</td>
<td>year of the data point if applicable otherwise NA</td>
</tr>
<tr class="odd">
<td>uncertainty</td>
<td>uncertainty <em>value</em> (for estimates)</td>
</tr>
<tr class="even">
<td>uncertainty_label</td>
<td>label for the uncertainty value (i.e. se, sd, cv…)</td>
</tr>
<tr class="odd">
<td>{strata}</td>
<td>a series of additional columns when stratification of the stock is
present (fleet, age, time, area, season, sex, growth pattern)</td>
</tr>
<tr class="even">
<td>likelihood</td>
<td>if present, the likelihood value for the label; typically NA</td>
</tr>
<tr class="odd">
<td>initial</td>
<td>the initial estimate input into the model associated with the label,
if applicable</td>
</tr>
</tbody>
</table>
<p>There are a variety of ways to stratify the stock. The current
converter is built to recognize the following:</p>
<!---
The following code does NOT create separate columns when pkgdown site is built
--->
<!--- 
:::::::::::::: {.columns}
::: {.column width="40%"}
--->
<ul>
<li>month</li>
<li>fleet</li>
<li>fleet_name</li>
<li>age</li>
<li>time</li>
<li>area</li>
<li>season</li>
<li>subseason</li>
<li>sex</li>
<li>sexes (only if indicating difference from above)</li>
<li>growth_pattern / gp</li>
</ul>
<!--- 
:::
::: {.column width="60%"}
---><ul>
<li>len_bins (length bins for length-at-age models or related length
series outputs)</li>
<li>birthseas</li>
<li>settlement</li>
<li>morph</li>
<li>type</li>
<li>platoon</li>
<li>part</li>
<li>bin</li>
<li>kind</li>
<li>nsim</li>
<li>age_a</li>
</ul>
<!--- 
:::
::::::::::::::
---><p><strong>Notes:</strong></p>
<p><em>NA is present in any of the above columns if there isn’t an
occurrence from the original assessment model output</em></p>
<p><em>Era was removed as a factor from SS3 converted output files since
this is something that could be assumed due to the set up of the
data</em></p>
</div>
<div class="section level2">
<h2 id="sec-namecon">Naming Conventions<a class="anchor" aria-label="anchor" href="#sec-namecon"></a>
</h2>
<p>Another hurdle to tackle is naming conventions. We have attempted to
create a standard naming convention system so that the same values are
called each time no matter the assessment model. Unfortunately, this
can’t be perfect, but there are approaches we took to standardize naming
as best as we could. In terms of naming:</p>
<ol style="list-style-type: decimal">
<li>Generally, labels and other strings are lowercase. Exceptions to
this case only include commonly referred to fisheries acronyms such as
biomass (B), R0, etc…</li>
</ol>
<ul>
<li>This does not apply to catch and fishing mortality since C and F are
used in the R language (a common language used in fisheries). In these
two cases, the terms are spelled out in lowercase and string case.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p>Fleet names are inherited so they are easily called by the
analyst familiar with the data.</p></li>
<li><p>Labels with more than one word use string case
(i.e. spawning_biomass).</p></li>
<li><p>The full name is used for the label, unless there is a common and
<em>well known</em> acronym for it such as spr, cpue, R0, or it is a
point relative to a reference point (i.e. b_msy =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">B_{msy}</annotation></semantics></math>,
b_b_msy =
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>/</mi><msub><mi>B</mi><mrow><mi>m</mi><mi>s</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">B/B_{msy}</annotation></semantics></math>)</p></li>
<li><p>For labels specific to a stock or assessment model, they were
kept in the converted output, but edited/expanded upon following the
above conventions.</p></li>
<li><p>In cases where a label could not be standardized, the same label
was kept in the converted output. We hope that these remaining names can
be standardized in the future through collaboration with the respective
analysts using them.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="final-formatting">Final Formatting<a class="anchor" aria-label="anchor" href="#final-formatting"></a>
</h2>
<p><a href="https://github.com/nmfs-ost/asar/blob/main/R/convert_output.R" class="external-link"><code>convert_output()</code></a>
exports data frames as a csv. While this is not necessary to the
function of {asar} and {stockplotr} packages as a whole due to their
setup, we recommend continuing this practice to remain consistent with
the function.</p>
<p><em>UPDATE</em>: we no longer offer the option to save the data frame
as a csv. This was removed in a current version of {asar}. We now
recommend either converting each time you want the data frame in your
environment or save as desired. The function does not take long to run,
but can take a long time to save due to its size.</p>
<p>The final data frame does not manipulate column typing (character,
numeric, etc.). We have left that to the analyst or other functions
since there can be conflicts within the estimates due to NAs. Ideally,
all columns beside the following with remain as characters or factors
and the following will be converted to numeric:</p>
<ul>
<li>estimate</li>
<li>uncertainty</li>
<li>initial</li>
<li>likelihood</li>
</ul>
<p>In conclusion, the final data frame should be very long with
repeating years and factors to represent each point of data from the
output file. Some metrics such as estimated stock-recruitment curve,
weight-length relationship or other similar parameters are not currently
in this function. There are also a number of “keywords” found in the SS3
Report.sso file that are not in the converted output file. We plan to
update this in the future, but we prioritized the converter to contain
information for plotting.</p>
</div>
<div class="section level2">
<h2 id="helpful-functions-to-mainpulate-data">Helpful Functions to Mainpulate Data<a class="anchor" aria-label="anchor" href="#helpful-functions-to-mainpulate-data"></a>
</h2>
<p>The following functions were used in the <a href="https://github.com/nmfs-ost/asar/blob/main/R/convert_output.R" class="external-link"><code>convert_output()</code></a>
function that could be helpful for users replicating it for other
assessment models:</p>
<ul>
<li>dplyr::mutate</li>
<li>dplyr::case_when</li>
<li>dplyr::inner_join/dplyr::outer_join</li>
<li>tidyr::pivot_longer/tidyr::pivot_wider</li>
<li>tidyr::rownames_to_column</li>
<li>stringr::str_replace</li>
<li>stringr::str_remove</li>
<li>stringr::str_extract</li>
<li>tibble::rowid_to_columns</li>
<li>tidyselect::any_of/tidyselect::all_of</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samantha Schiano, Sophie Breitbart, Steve Saul.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
